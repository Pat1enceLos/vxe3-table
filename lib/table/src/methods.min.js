"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils/methods/xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_cell=_interopRequireDefault(require("../../cell")),_vXETable=_interopRequireDefault(require("../../v-x-e-table")),_tools=require("../../tools"),_methods=require("xe-utils/methods");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var browse=_tools.DomTools.browse,isWebkit=browse["-webkit"]&&!browse.edge,debounceScrollYDuration=browse.msie?40:20,resizableStorageKey="VXE_TABLE_CUSTOM_COLUMN_WIDTH",visibleStorageKey="VXE_TABLE_CUSTOM_COLUMN_VISIBLE";function getRowUniqueId(){return _xeUtils.default.uniqueId("row_")}function getNextSortOrder(e,t){e=e.sortOpts.orders,t=t.order||null,t=e.indexOf(t)+1;return e[t<e.length?t:0]}function getCustomStorageMap(e){var t=_conf.default.version,e=_xeUtils.default.toStringJSON(localStorage.getItem(e));return e&&e._v===t?e:{_v:t}}function handleReserveRow(e,t){var i=e.fullAllDataRowMap;return t.filter(function(e){return i.has(e)})}var Methods={getParentElem:function(){return(this.$xegrid||this).$el.parentNode},getParentHeight:function(){return this.$xegrid?this.$xegrid.getParentHeight():this.getParentElem().clientHeight},getExcludeHeight:function(){return this.$xegrid?this.$xegrid.getExcludeHeight():0},clearAll:function(){return this.inited=!1,this.clearSort(),this.clearCurrentRow(),this.clearCurrentColumn(),this.clearRadioRow(),this.clearRadioReserve(),this.clearCheckboxRow(),this.clearCheckboxReserve(),this.clearRowExpand(),this.clearTreeExpand(),_vXETable.default._edit&&this.clearActived(),_vXETable.default._filter&&this.clearFilter(),(this.keyboardConfig||this.mouseConfig)&&this.clearSelected(),this.clearScroll()},syncData:function(){var e=this;return this.$nextTick().then(function(){return e.tableData=[],e.$nextTick().then(function(){return e.loadTableData(e.tableFullData)})})},updateData:function(){return this.handleTableData(!0).then(this.updateFooter).then(this.recalculate)},handleTableData:function(e){var t=this.scrollYLoad,i=this.scrollYStore,e=e?this.updateAfterFullData():this.afterFullData;return this.tableData=t?e.slice(i.startIndex,Math.max(i.startIndex+i.renderSize,1)):e.slice(0),this.$nextTick()},loadTableData:function(e){var t=this,i=this.keepSource,o=this.treeConfig,r=this.editStore,l=this.sYOpts,n=this.scrollYStore,s=e?e.slice(0):[],l=!o&&-1<l.gt&&l.gt<s.length;return n.startIndex=0,n.visibleIndex=0,r.insertList=[],r.removeList=[],this.tableFullData=s,this.updateCache(!0),this.tableSynchData=e,i&&(this.tableSourceData=_xeUtils.default.clone(s,!0)),(this.scrollYLoad=l)&&(this.height||this.maxHeight||_tools.UtilTools.error("vxe.error.reqProp",["height | max-height"]),this.showOverflow||_tools.UtilTools.warn("vxe.error.reqProp",["show-overflow"]),this.spanMethod&&_tools.UtilTools.warn("vxe.error.scrollErrProp",["span-method"])),this.handleTableData(!0),this.updateFooter(),this.computeScrollLoad().then(function(){return t.isLoadData=!0,t.computeRowHeight(),t.handleReserveStatus(),t.checkSelectionStatus(),t.$nextTick().then(t.recalculate).then(t.refreshScroll)})},loadData:function(e){return this.inited=!0,this.loadTableData(e).then(this.recalculate)},reloadData:function(e){var t=this;return this.clearAll().then(function(){return t.inited=!0,t.loadTableData(e)}).then(this.handleDefaults)},reloadRow:function(e,t,i){var o,r=this.keepSource,l=this.tableSourceData,n=this.tableData;return r?((r=l[o=this.getRowIndex(e)])&&e&&(i?_xeUtils.default.set(r,i,_xeUtils.default.get(t||e,i)):t?(l[o]=t,_xeUtils.default.clear(e,void 0),Object.assign(e,this.defineField(Object.assign({},t))),this.updateCache(!0)):_xeUtils.default.destructuring(r,_xeUtils.default.clone(e,!0))),this.tableData=n.slice(0)):_tools.UtilTools.warn("vxe.error.reqProp",["keep-source"]),this.$nextTick()},loadColumn:function(e){var t=this;return this.collectColumn=_xeUtils.default.mapTree(e,function(e){return _cell.default.createColumn(t,e)}),this.$nextTick()},reloadColumn:function(e){return this.clearAll(),this.loadColumn(e)},updateCache:function(o){function e(e,t){var i=_tools.UtilTools.getRowid(r,e);i||(i=getRowUniqueId(),_xeUtils.default.set(e,u,i)),d&&e[n.hasChild]&&_xeUtils.default.isUndefined(e[n.children])&&(e[n.children]=null),t={row:e,rowid:i,index:l?-1:t},o&&(c[i]=t,s.set(e,t)),h[i]=t,a.set(e,t)}var r=this,l=this.treeConfig,n=this.treeOpts,t=this.tableFullData,s=this.fullDataRowMap,a=this.fullAllDataRowMap,c=this.fullDataRowIdData,h=this.fullAllDataRowIdData,u=_tools.UtilTools.getRowkey(this),d=l&&n.lazy;o&&(c=this.fullDataRowIdData={},s.clear()),h=this.fullAllDataRowIdData={},a.clear(),l?_xeUtils.default.eachTree(t,e,n):t.forEach(e)},appendTreeCache:function(e,t){var i,o=this,r=this.keepSource,l=this.tableSourceData,n=this.treeOpts,s=this.fullDataRowIdData,a=this.fullDataRowMap,c=this.fullAllDataRowMap,h=this.fullAllDataRowIdData,u=n.children,d=n.hasChild,f=_tools.UtilTools.getRowkey(this),g=_tools.UtilTools.getRowid(this,e);r&&(i=_xeUtils.default.findTree(l,function(e){return g===_tools.UtilTools.getRowid(o,e)},n)),_xeUtils.default.eachTree(t,function(e,t){var i=_tools.UtilTools.getRowid(o,e);i||(i=getRowUniqueId(),_xeUtils.default.set(e,f,i)),e[d]&&_xeUtils.default.isUndefined(e[u])&&(e[u]=null);t={row:e,rowid:i,index:t};s[i]=t,a.set(e,t),h[i]=t,c.set(e,t)},n),i&&(i.item[u]=_xeUtils.default.clone(t,!0))},cacheColumnMap:function(){function n(e,t){var i=e.id,o=e.property,r=e.fixed,l=e.type,t={column:e,colid:i,index:t};o&&(u[o]=t),!a&&r&&(a=r),s||"expand"!==l||(s=e),h[i]=t,c.set(e,t)}var s,a,e=this.isGroup,t=this.tableFullColumn,i=this.collectColumn,c=this.fullColumnMap,h=this.fullColumnIdData={},u=this.fullColumnFieldData={};c.clear(),e?_xeUtils.default.eachTree(i,function(e,t,i,o,r,l){e.level=l.length,n(e,t)}):t.forEach(n),a&&s&&_tools.UtilTools.warn("vxe.error.errConflicts",["column.fixed","column.type=expand"]),this.expandColumn=s},getRowNode:function(e){var t=this;if(e){var i=this.treeConfig,o=this.treeOpts,r=this.tableFullData,l=this.fullAllDataRowIdData,n=e.getAttribute("data-rowid");if(i){o=_xeUtils.default.findTree(r,function(e){return _tools.UtilTools.getRowid(t,e)===n},o);if(o)return o}else if(l[n]){l=l[n];return{item:l.row,index:l.index,items:r}}}return null},getColumnNode:function(e){if(e){var t=this.fullColumnIdData,i=this.tableFullColumn,e=t[e.getAttribute("data-colid")];return{item:e.column,index:e.index,items:i}}return null},getRowIndex:function(e){return this.fullDataRowMap.has(e)?this.fullDataRowMap.get(e).index:-1},_getRowIndex:function(e){return this.afterFullData.indexOf(e)},$getRowIndex:function(e){return this.tableData.indexOf(e)},getColumnIndex:function(e){return this.fullColumnMap.has(e)?this.fullColumnMap.get(e).index:-1},_getColumnIndex:function(e){return this.visibleColumn.indexOf(e)},$getColumnIndex:function(e){return this.tableColumn.indexOf(e)},isSeqColumn:function(e){return e&&"seq"===e.type},defineField:function(i){var e=this.treeConfig,t=this.treeOpts,o=_tools.UtilTools.getRowkey(this);return this.visibleColumn.forEach(function(e){var t=e.property,e=e.editRender;t&&!_xeUtils.default.has(i,t)&&_xeUtils.default.set(i,t,e&&!_xeUtils.default.isUndefined(e.defaultValue)?e.defaultValue:null)}),e&&t.lazy&&_xeUtils.default.isUndefined(i[t.children])&&(i[t.children]=null),_xeUtils.default.get(i,o)||_xeUtils.default.set(i,o,getRowUniqueId()),i},createData:function(e){var t=this,i=_tools.UtilTools.getRowkey(this),o=e.map(function(e){return t.defineField(Object.assign({},e,_defineProperty({},i,null)))});return this.$nextTick().then(function(){return o})},createRow:function(e){var t=this,i=_xeUtils.default.isArray(e);return i||(e=[e]),this.$nextTick().then(function(){return t.createData(e).then(function(e){return i?e:e[0]})})},revertData:function(e,i){var o=this,t=this.keepSource,r=this.tableSourceData,l=this.tableFullData;return t?arguments.length?(e&&!_xeUtils.default.isArray(e)&&(e=[e]),e.forEach(function(e){var t;o.isInsertByRow(e)||(t=l.indexOf(e),(t=r[t])&&e&&(i?_xeUtils.default.set(e,i,_xeUtils.default.clone(_xeUtils.default.get(t,i),!0)):_xeUtils.default.destructuring(e,_xeUtils.default.clone(t,!0))))}),this.$nextTick()):this.reloadData(r):(_tools.UtilTools.warn("vxe.error.reqProp",["keep-source"]),this.$nextTick())},clearData:function(e,t){var i=this.tableFullData,o=this.visibleColumn;return arguments.length?e&&!_xeUtils.default.isArray(e)&&(e=[e]):e=i,t?e.forEach(function(e){return _xeUtils.default.set(e,t,null)}):e.forEach(function(t){o.forEach(function(e){e.property&&_tools.UtilTools.setCellValue(t,e,null)})}),this.$nextTick()},isInsertByRow:function(e){return-1<this.editStore.insertList.indexOf(e)},isUpdateByRow:function(e,t){var i=this,o=this.visibleColumn,r=this.keepSource,l=this.treeConfig,n=this.treeOpts,s=this.tableSourceData,a=this.fullDataRowIdData;if(r){var c,h,u=_tools.UtilTools.getRowid(this,e);if(!a[u])return!1;if(l?(l=n.children,n=_xeUtils.default.findTree(s,function(e){return u===_tools.UtilTools.getRowid(i,e)},n),e=Object.assign({},e,_defineProperty({},l,null)),n&&(h=Object.assign({},n.item,_defineProperty({},l,null)))):h=s[a[u].index],h){if(1<arguments.length)return!_xeUtils.default.isEqual(_xeUtils.default.get(h,t),_xeUtils.default.get(e,t));for(var d=0,f=o.length;d<f;d++)if((c=o[d].property)&&!_xeUtils.default.isEqual(_xeUtils.default.get(h,c),_xeUtils.default.get(e,c)))return!0}}return!1},getColumns:function(e){var t=this.visibleColumn;return arguments.length?t[e]:t.slice(0)},getColumnById:function(e){var t=this.fullColumnIdData;return t[e]?t[e].column:null},getColumnByField:function(e){var t=this.fullColumnFieldData;return t[e]?t[e].column:null},getTableColumn:function(){return{collectColumn:this.collectColumn.slice(0),fullColumn:this.tableFullColumn.slice(0),visibleColumn:this.visibleColumn.slice(0),tableColumn:this.tableColumn.slice(0)}},getData:function(e){var t=this.data||this.tableSynchData;return arguments.length?t[e]:t.slice(0)},getCheckboxRecords:function(){var t,e=this.tableFullData,i=this.treeConfig,o=this.treeOpts,r=this.checkboxOpts.checkField;return r?i?_xeUtils.default.filterTree(e,function(e){return _xeUtils.default.get(e,r)},o):e.filter(function(e){return _xeUtils.default.get(e,r)}):(t=this.selection,i?_xeUtils.default.filterTree(e,function(e){return-1<t.indexOf(e)},o):e.filter(function(e){return-1<t.indexOf(e)}))},updateAfterFullData:function(){var e,t,i,o,r=this.visibleColumn,l=this.tableFullData,a=this.filterOpts,n=this.sortOpts,s=l.slice(0),c=_xeUtils.default.find(r,function(e){return e.order}),h=[];return r.forEach(function(e){var t,i;e.filters&&e.filters.length&&(t=[],i=[],e.filters.forEach(function(e){e.checked&&(i.push(e),t.push(e.value))}),h.push({column:e,valueList:t,itemList:i}))}),h.length&&(s=s.filter(function(s){return h.every(function(e){var t=e.column,i=e.valueList,o=e.itemList;if(!i.length||a.remote)return!0;var r=t.filterRender,l=t.property,n=t.filterMethod,e=a.filterMethod,r=r?_vXETable.default.renderer.get(r.name):null;return!n&&r&&r.renderFilter&&(n=r.filterMethod),e&&!n?e({options:o,values:i,row:s,column:t}):n?o.some(function(e){return n({value:e.value,option:e,row:s,column:t})}):-1<i.indexOf(_xeUtils.default.get(s,l))})})),c&&c.order&&(e=c.remoteSort,t=c.sortMethod,o=c.property,l=c.order,r=n.sortMethod,(_xeUtils.default.isBoolean(e)?e:n.remote)||(s=r&&!t?r({data:s,column:c,property:o,order:l,$table:this})||s:(i={$table:this},o=t?s.sort(t):_xeUtils.default.sortBy(s,c.sortBy||(c.formatter?function(e){return _tools.UtilTools.getCellLabel(e,c,i)}:o)),"desc"===l?o.reverse():o))),this.afterFullData=s},getRowById:function(e){var t=this.fullDataRowIdData;return t[e]?t[e].row:null},getRowid:function(e){var t=this.fullAllDataRowMap;return t.has(e)?t.get(e).rowid:null},getTableData:function(){var e=this.tableFullData,t=this.afterFullData,i=this.tableData,o=this.footerData;return{fullData:e.slice(0),visibleData:t.slice(0),tableData:i.slice(0),footerData:o.slice(0)}},handleDefaults:function(){var e=this;this.checkboxConfig&&this.handleDefaultSelectionChecked(),this.radioConfig&&this.handleDefaultRadioChecked(),this.sortConfig&&this.handleDefaultSort(),this.expandConfig&&this.handleDefaultRowExpand(),this.treeConfig&&this.handleDefaultTreeExpand(),this.$nextTick(function(){return setTimeout(e.recalculate)})},hideColumn:function(e){return e.visible=!1,this.handleCustom()},showColumn:function(e){return e.visible=!0,this.handleCustom()},resetColumn:function(e){var t=this.customOpts.checkMethod,i=Object.assign({visible:!0,resizable:!0===e},e);return this.tableFullColumn.forEach(function(e){i.resizable&&(e.resizeWidth=0),t&&!t({column:e})||(e.visible=e.defaultVisible)}),i.resizable&&this.saveCustomResizable(!0),this.handleCustom()},handleCustom:function(){return this.saveCustomVisible(),this.analyColumnWidth(),this.refreshColumn()},restoreCustomStorage:function(){var i,o,e=this.id,t=this.collectColumn,r=this.customConfig,l=this.customOpts,n=l.storage,s=!0===l.storage,l=s||n&&n.resizable,n=s||n&&n.visible;r&&(l||n)&&(i={},e?(!l||(l=getCustomStorageMap(resizableStorageKey)[e])&&_xeUtils.default.each(l,function(e,t){i[t]={field:t,resizeWidth:e}}),!n||(n=getCustomStorageMap(visibleStorageKey)[e])&&(n=(e=n.split("|"))[0]?e[0].split(","):[],e=e[1]?e[1].split(","):[],n.forEach(function(e){i[e]?i[e].visible=!1:i[e]={field:e,visible:!1}}),e.forEach(function(e){i[e]?i[e].visible=!0:i[e]={field:e,visible:!0}})),o={},_xeUtils.default.eachTree(t,function(e){var t=e.getKey();t&&(o[t]=e)}),_xeUtils.default.each(i,function(e,t){var i=e.visible,e=e.resizeWidth,t=o[t];t&&(_xeUtils.default.isNumber(e)&&(t.resizeWidth=e),_xeUtils.default.isBoolean(i)&&(t.visible=i))})):_tools.UtilTools.error("vxe.error.reqProp",["id"]))},saveCustomVisible:function(){var i,o,e=this.id,t=this.collectColumn,r=this.customConfig,l=this.customOpts,n=l.checkMethod,s=l.storage,s=!0===l.storage||s&&s.visible;r&&s&&(s=getCustomStorageMap(visibleStorageKey),i=[],o=[],e?(_xeUtils.default.eachTree(t,function(e){var t;n&&!n({column:e})||(!e.visible&&e.defaultVisible?(t=e.getKey())&&i.push(t):!e.visible||e.defaultVisible||(e=e.getKey())&&o.push(e))}),s[e]=[i.join(",")].concat(o.length?[o.join(",")]:[]).join("|")||void 0,localStorage.setItem(visibleStorageKey,_xeUtils.default.toJSONString(s))):_tools.UtilTools.error("vxe.error.reqProp",["id"]))},saveCustomResizable:function(e){var i,t=this.id,o=this.collectColumn,r=this.customConfig,l=this.customOpts,n=l.storage,n=!0===l.storage||n&&n.resizable;r&&n&&(n=getCustomStorageMap(resizableStorageKey),t?(e||(i=_xeUtils.default.isPlainObject(n[t])?n[t]:{},_xeUtils.default.eachTree(o,function(e){var t;!e.resizeWidth||(t=e.getKey())&&(i[t]=e.renderWidth)})),n[t]=_xeUtils.default.isEmpty(i)?void 0:i,localStorage.setItem(resizableStorageKey,_xeUtils.default.toJSONString(n))):_tools.UtilTools.error("vxe.error.reqProp",["id"]))},refreshColumn:function(){var t,i,o,e=this,n=[],s=[],a=[],r=this.collectColumn,l=this.tableFullColumn,c=this.isGroup,h=this.columnStore,u=this.sXOpts,d=this.scrollXStore;c?(t=[],i=[],o=[],_xeUtils.default.eachTree(r,function(e,t,i,o,r){var l=_tools.UtilTools.hasChildrenList(e);r&&r.fixed&&(e.fixed=r.fixed),r&&e.fixed!==r.fixed&&_tools.UtilTools.error("vxe.error.groupFixed"),l?e.visible=!!_xeUtils.default.findTree(e.children,function(e){return _tools.UtilTools.hasChildrenList(e)?null:e.visible}):e.visible&&("left"===e.fixed?n:"right"===e.fixed?a:s).push(e)}),r.forEach(function(e){e.visible&&("left"===e.fixed?t:"right"===e.fixed?o:i).push(e)}),this.tableGroupColumn=t.concat(i).concat(o)):l.forEach(function(e){e.visible&&("left"===e.fixed?n:"right"===e.fixed?a:s).push(e)});var f=n.concat(s).concat(a),r=f,l=-1<u.gt&&u.gt<l.length;return Object.assign(h,{leftList:n,centerList:s,rightList:a}),l&&c&&(l=!1,_tools.UtilTools.warn("vxe.error.scrollXNotGroup")),l&&(this.showHeader&&!this.showHeaderOverflow&&_tools.UtilTools.warn("vxe.error.reqProp",["show-header-overflow"]),this.showFooter&&!this.showFooterOverflow&&_tools.UtilTools.warn("vxe.error.reqProp",["show-footer-overflow"]),this.spanMethod&&_tools.UtilTools.warn("vxe.error.scrollErrProp",["span-method"]),this.footerSpanMethod&&_tools.UtilTools.warn("vxe.error.scrollErrProp",["footer-span-method"]),Object.assign(d,{startIndex:0,visibleIndex:0}),r=f.slice(d.startIndex,d.startIndex+d.renderSize)),this.scrollXLoad=l,this.tableColumn=r,this.visibleColumn=f,this.$nextTick().then(function(){e.updateFooter(),e.recalculate(!0)})},analyColumnWidth:function(){var t=this.columnWidth,i=this.columnMinWidth,o=[],r=[],l=[],n=[],s=[],a=[];this.tableFullColumn.forEach(function(e){t&&!e.width&&(e.width=t),i&&!e.minWidth&&(e.minWidth=i),e.visible&&(e.resizeWidth?o:_tools.DomTools.isPx(e.width)?r:_tools.DomTools.isScale(e.width)?n:_tools.DomTools.isPx(e.minWidth)?l:_tools.DomTools.isScale(e.minWidth)?s:a).push(e)}),Object.assign(this.columnStore,{resizeList:o,pxList:r,pxMinList:l,scaleList:n,scaleMinList:s,autoList:a})},refreshScroll:function(){var e=this,t=this.lastScrollLeft,i=this.lastScrollTop;return this.clearScroll(),this.$nextTick().then(function(){if(t||i)return e.lastScrollLeft=0,e.lastScrollTop=0,e.scrollTo(t,i)})},recalculate:function(e){var t=this,i=this.$refs,o=i.tableBody,r=i.tableHeader,i=i.tableFooter,l=o?o.$el:null,n=r?r.$el:null,s=i?i.$el:null;return l&&(this.autoCellWidth(n,l,s),!0===e)?this.computeScrollLoad().then(function(){t.autoCellWidth(n,l,s),t.computeScrollLoad()}):this.computeScrollLoad()},autoCellWidth:function(e,t,i){var o=0,r=t.clientWidth,l=r,n=l/100,s=this.fit,a=this.columnStore,c=a.resizeList,h=a.pxMinList,u=a.pxList,d=a.scaleList,f=a.scaleMinList,a=a.autoList;if(h.forEach(function(e){var t=parseInt(e.minWidth);o+=t,e.renderWidth=t}),f.forEach(function(e){var t=Math.floor(parseInt(e.minWidth)*n);o+=t,e.renderWidth=t}),d.forEach(function(e){var t=Math.floor(parseInt(e.width)*n);o+=t,e.renderWidth=t}),u.forEach(function(e){var t=parseInt(e.width);o+=t,e.renderWidth=t}),c.forEach(function(e){var t=parseInt(e.resizeWidth);o+=t,e.renderWidth=t}),n=0<(l-=o)?Math.floor(l/(f.length+h.length+a.length)):0,s?0<l&&f.concat(h).forEach(function(e){o+=n,e.renderWidth+=n}):n=40,a.forEach(function(e){var t=Math.max(n,40);e.renderWidth=t,o+=t}),s){var g=d.concat(f).concat(h).concat(a),x=g.length-1;if(0<x){var p=r-o;if(0<p){for(;0<p&&0<=x;)p--,g[x--].renderWidth++;o=r}}}h=t.offsetHeight,a=t.scrollHeight>t.clientHeight;this.scrollbarWidth=a?t.offsetWidth-r:0,this.overflowY=a,this.tableWidth=o,this.tableHeight=h,e?(this.headerHeight=e.clientHeight,e.scrollLeft!==t.scrollLeft&&(e.scrollLeft=t.scrollLeft)):this.headerHeight=0,i?(e=i.offsetHeight,this.scrollbarHeight=Math.max(e-i.clientHeight,0),this.overflowX=o>i.clientWidth,this.footerHeight=e):(this.footerHeight=0,this.scrollbarHeight=Math.max(h-t.clientHeight,0),this.overflowX=r<o),this.parentHeight=Math.max(this.headerHeight+this.footerHeight+20,this.getParentHeight()),this.overflowX&&this.checkScrolling()},updateStyle:function(){var u=this,t=this.$refs,d=this.isGroup,f=this.fullColumnIdData,e=this.height,g=this.parentHeight,x=this.border,p=this.headerHeight,v=this.showFooter,m=this.showOverflow,w=this.showHeaderOverflow,b=this.showFooterOverflow,T=this.footerHeight,R=this.tableHeight,C=this.tableWidth,_=this.scrollbarHeight,S=this.scrollbarWidth,E=this.scrollXLoad,y=this.scrollYLoad,U=this.cellOffsetWidth,D=this.columnStore,k=this.elemStore,i=this.editStore,o=this.currentRow,r=this.mouseConfig,O=this.maxHeight,$=this.tableColumn,I=0;e&&(I="auto"===e?g:(_tools.DomTools.isScale(e)?Math.floor(parseInt(e)/100*g):_xeUtils.default.toNumber(e))-this.getExcludeHeight(),v&&(I+=_));var l=t.emptyPlaceholder,e=k["main-body-wrapper"];return l&&(l.style.top="".concat(p,"px"),l.style.height=e?"".concat(e.offsetHeight-_,"px"):""),["main","left","right"].forEach(function(a,e){var s=0<e?a:"",c=D["".concat(s,"List")],h=t["".concat(s,"Container")];["header","body","footer"].forEach(function(r){var e,t,i,o=k["".concat(a,"-").concat(r,"-wrapper")],l=k["".concat(a,"-").concat(r,"-table")];"header"===r?(t=C,E&&(s&&($=c),t=$.reduce(function(e,t){return e+t.renderWidth},0)),l&&(l.style.width=t?"".concat(t+S,"px"):"",browse.msie&&_xeUtils.default.arrayEach(l.querySelectorAll(".vxe-resizable"),function(e){e.style.height="".concat(e.parentNode.offsetHeight,"px")})),(e=k["".concat(a,"-").concat(r,"-repair")])&&(e.style.width="".concat(C,"px")),t=k["".concat(a,"-").concat(r,"-list")],d&&t&&_xeUtils.default.arrayEach(t.querySelectorAll(".col--group"),function(e){var t=u.getColumnNode(e).item,i=t.showHeaderOverflow,i=_xeUtils.default.isBoolean(i)?i:w,i="title"===i||(!0===i||"tooltip"===i)||"ellipsis"===i,o=0,r=0;i&&_xeUtils.default.eachTree(t.children,function(e){e.children&&t.children.length||r++,o+=e.renderWidth}),e.style.width=i?"".concat(o-r-(x?2:0),"px"):""})):"body"===r?(e=k["".concat(a,"-").concat(r,"-emptyBlock")],o&&(O?(O="auto"===O?g:_tools.DomTools.isScale(O)?Math.floor(parseInt(O)/100*g):_xeUtils.default.toNumber(O),o.style.maxHeight="".concat(s?O-p-(v?0:_):O-p,"px")):o.style.height=0<I?"".concat(s?(0<I?I-p-T:R)-(v?0:_):I-p-T,"px"):""),h&&(i="right"===s,t=D["".concat(s,"List")],o.style.top="".concat(p,"px"),h.style.height="".concat((0<I?I-p-T:R)+p+T-_*(v?2:1),"px"),h.style.width="".concat(t.reduce(function(e,t){return e+t.renderWidth},i?S:0),"px")),i=C,s&&m?i=($=c).reduce(function(e,t){return e+t.renderWidth},0):E&&(s&&($=c),i=$.reduce(function(e,t){return e+t.renderWidth},0)),l&&(l.style.width=i?"".concat(i,"px"):"",l.style.paddingRight=S&&s&&(browse["-moz"]||browse.safari)?"".concat(S,"px"):""),e&&(e.style.width=i?"".concat(i,"px"):"")):"footer"===r&&(n=C,s&&m?n=($=c).reduce(function(e,t){return e+t.renderWidth},0):E&&(s&&($=c),n=$.reduce(function(e,t){return e+t.renderWidth},0)),o&&(h&&(o.style.top="".concat(0<I?I-T:R+p,"px")),o.style.marginTop="".concat(-_,"px")),l&&(l.style.width=n?"".concat(n+S,"px"):""));var n=k["".concat(a,"-").concat(r,"-colgroup")];n&&_xeUtils.default.arrayEach(n.children,function(e){var n,t,i,s,o=e.getAttribute("name");"col_gutter"===o&&(e.style.width="".concat(S,"px")),f[o]&&(t=(n=f[o].column).showHeaderOverflow,i=n.showFooterOverflow,o=n.showOverflow,e.style.width="".concat(n.renderWidth,"px"),s="title"===(o="header"===r?_xeUtils.default.isUndefined(t)||_xeUtils.default.isNull(t)?w:t:"footer"===r?_xeUtils.default.isUndefined(i)||_xeUtils.default.isNull(i)?b:i:_xeUtils.default.isUndefined(o)||_xeUtils.default.isNull(o)?m:o)||(!0===o||"tooltip"===o)||"ellipsis"===o,o=k["".concat(a,"-").concat(r,"-list")],"header"===r||"footer"===r?E&&!s&&(s=!0):!E&&!y||s||(s=!0),o&&_xeUtils.default.arrayEach(o.querySelectorAll(".".concat(n.id)),function(e){var t=parseInt(e.getAttribute("colspan")||1),e=e.querySelector(".vxe-cell"),i=n.renderWidth;if(e){if(1<t)for(var o=u.getColumnIndex(n),r=1;r<t;r++){var l=u.getColumns(o+r);l&&(i+=l.renderWidth)}e.style.width=s?"".concat(i-U*t,"px"):""}}))})})}),o&&this.setCurrentRow(o),r&&r.selected&&i.selected.row&&i.selected.column&&this.addColSdCls(),this.$nextTick()},checkScrolling:function(){var e=this.$refs,t=e.tableBody,i=e.leftContainer,e=e.rightContainer,t=t?t.$el:null;t&&(i&&_tools.DomTools[0<t.scrollLeft?"addClass":"removeClass"](i,"scrolling--middle"),e&&_tools.DomTools[t.clientWidth<t.scrollWidth-Math.ceil(t.scrollLeft)?"addClass":"removeClass"](e,"scrolling--middle"))},preventEvent:function(t,e,i,o,r){var l,n=this;return _vXETable.default.interceptor.get(e).some(function(e){return!1===e(Object.assign({$grid:n.$xegrid,$table:n,$event:t},i))})||o&&(l=o()),r&&r(),l},handleGlobalMousedownEvent:function(t){var i=this,o=this.$el,e=this.$refs,r=this.mouseConfig,l=this.editStore,n=this.ctxMenuStore,s=this.editOpts,a=this.filterStore,c=this.getRowNode,h=l.actived,u=e.filterWrapper,l=e.validTip;u&&(_tools.DomTools.getEventTargetNode(t,o,"vxe-cell--filter").flag||_tools.DomTools.getEventTargetNode(t,u.$el).flag||_tools.DomTools.getEventTargetNode(t,document.body,"vxe-table--ignore-clear").flag||this.preventEvent(t,"event.clearFilter",a.args,this.closeFilter)),h.row?!1!==s.autoClear&&(l&&_tools.DomTools.getEventTargetNode(t,l.$el).flag||(!this.lastCallTime||this.lastCallTime+50<Date.now())&&(_tools.DomTools.getEventTargetNode(t,document.body,"vxe-table--ignore-clear").flag||this.preventEvent(t,"event.clearActived",h.args,function(){var e;!(("row"===s.mode?!!(e=_tools.DomTools.getEventTargetNode(t,o,"vxe-body--row")).flag&&c(e.targetElem).item!==h.args.row:!_tools.DomTools.getEventTargetNode(t,o,"col--edit").flag)||_tools.DomTools.getEventTargetNode(t,o,"vxe-header--row").flag||_tools.DomTools.getEventTargetNode(t,o,"vxe-footer--row").flag)&&_tools.DomTools.getEventTargetNode(t,o).flag||setTimeout(function(){return i.clearActived(t)})}))):r&&(_tools.DomTools.getEventTargetNode(t,o).flag||_tools.DomTools.getEventTargetNode(t,e.tableWrapper).flag||this.clearSelected()),n.visible&&this.$refs.ctxWrapper&&!_tools.DomTools.getEventTargetNode(t,this.$refs.ctxWrapper.$el).flag&&this.closeMenu(),this.isActivated=_tools.DomTools.getEventTargetNode(t,(this.$xegrid||this).$el).flag},handleGlobalBlurEvent:function(){this.closeFilter(),this.closeMenu()},handleGlobalMousewheelEvent:function(){this.clostTooltip(),this.closeMenu()},handleGlobalKeydownEvent:function(k){var O=this;this.isActivated&&this.preventEvent(k,"event.keydown",null,function(){var e,t,i,o=O.isCtxMenu,r=O.ctxMenuStore,l=O.editStore,n=O.editOpts,s=O.mouseConfig,a=void 0===s?{}:s,c=O.keyboardConfig,h=void 0===c?{}:c,u=O.treeConfig,d=O.treeOpts,f=O.highlightCurrentRow,g=O.currentRow,x=l.selected,p=l.actived,v=k.keyCode,m=8===v,w=9===v,b=13===v,T=27===v,R=32===v,C=37===v,_=38===v,S=39===v,E=40===v,y=46===v,U=113===v,D=k.ctrlKey,s=k.shiftKey,c=k.altKey,l=C||_||S||E,o=o&&r.visible&&(b||R||l);T?(O.closeMenu(),O.closeFilter(),p.row&&(t=p.args,O.clearActived(k),a.selected&&O.$nextTick(function(){return O.handleSelected(t,k)}))):R&&(h.isArrow||h.isTab)&&x.row&&x.column&&("checkbox"===x.column.type||"radio"===x.column.type)?(k.preventDefault(),"checkbox"===x.column.type?O.handleToggleCheckRowEvent(x.args,k):O.triggerRadioRowEvent(k,x.args)):b&&!c&&h.isEnter&&(x.row||p.row||u&&f&&g)?D?p.row&&(t=p.args,O.clearActived(k),a.selected&&O.$nextTick(function(){return O.handleSelected(t,k)})):x.row||p.row?s?O.moveSelected((x.row?x:p).args,C,!0,S,!1,k):O.moveSelected((x.row?x:p).args,C,!1,S,!0,k):u&&f&&g&&((a=g[d.children])&&a.length&&(k.preventDefault(),e=a[0],t={$table:O,row:e},O.setTreeExpand(g,!0).then(function(){return O.scrollToRow(e)}).then(function(){return O.triggerCurrentRowEvent(k,t)}))):o?(k.preventDefault(),r.showChild&&_tools.UtilTools.hasChildrenList(r.selected)?O.moveCtxMenu(k,v,r,"selectChild",37,!1,r.selected.children):O.moveCtxMenu(k,v,r,"selected",39,!0,O.ctxMenuList)):U?x.row&&x.column&&(k.preventDefault(),O.handleActived(x.args,k)):l&&h.isArrow?x.row&&x.column?O.moveSelected(x.args,C,_,S,E,k):(_||E)&&f&&g&&O.moveCurrentRow(_,E,k):w&&h.isTab?x.row||x.column?O.moveTabSelected(x.args,s,k):(p.row||p.column)&&O.moveTabSelected(p.args,s,k):y||(u&&f&&g?m&&h.isArrow:m)?h.isDel&&(x.row||x.column)?(_tools.UtilTools.setCellValue(x.row,x.column,null),m&&O.handleActived(x.args,k)):m&&h.isArrow&&u&&f&&g&&((i=_xeUtils.default.findTree(O.afterFullData,function(e){return e===g},d).parent)&&(k.preventDefault(),t={$table:O,row:i},O.setTreeExpand(i,!1).then(function(){return O.scrollToRow(i)}).then(function(){return O.triggerCurrentRowEvent(k,t)}))):h.isEdit&&!D&&(R||48<=v&&v<=57||65<=v&&v<=90||96<=v&&v<=111||186<=v&&v<=192||219<=v&&v<=222)&&x.column&&x.row&&x.column.editRender&&(h.editMethod&&!1===h.editMethod(x.args,k)||n.activeMethod&&!n.activeMethod(x.args)||(_tools.UtilTools.setCellValue(x.row,x.column,null),O.handleActived(x.args,k))),O.emitEvent("keydown",{},k)})},handleGlobalResizeEvent:function(){this.closeMenu(),this.recalculate(!0)},handleTooltipLeaveEvent:function(){var e=this,t=this.tooltipOpts;setTimeout(function(){e.tooltipActive||e.clostTooltip()},t.leaveDelay)},handleTargetEnterEvent:function(){clearTimeout(this.tooltipTimeout),this.tooltipActive=!0,this.clostTooltip()},handleTargetLeaveEvent:function(){var e=this,t=this.tooltipOpts;this.tooltipActive=!1,t.enterable?this.tooltipTimeout=setTimeout(function(){e.$refs.tooltip.isHover||e.clostTooltip()},t.leaveDelay):this.clostTooltip()},triggerHeaderTooltipEvent:function(e,t){var i=this.tooltipStore,o=t.column,r=e.currentTarget;this.handleTargetEnterEvent(),i.column===o&&i.visible||this.handleTooltip(e,r,r.querySelector(".vxe-cell--title"),t)},triggerFooterTooltipEvent:function(e,t){var i=t.column,o=this.tooltipStore,r=e.currentTarget;this.handleTargetEnterEvent(),o.column===i&&o.visible||this.handleTooltip(e,r,r.children[0],t)},triggerTooltipEvent:function(e,t){var i=this.editConfig,o=this.editOpts,r=this.editStore,l=this.tooltipStore,n=r.actived,s=t.row,a=t.column,r=e.currentTarget;this.handleTargetEnterEvent(),i&&("row"===o.mode&&n.row===s||n.row===s&&n.column===a)||l.column===a&&l.row===s&&l.visible||this.handleTooltip(e,r,a.treeNode?r.querySelector(".vxe-tree-cell"):r.children[0],t)},handleTooltip:function(e,t,i,o){o.cell=t;var r=this.$refs,l=this.tooltipOpts,n=this.tooltipStore,s=o.column,a=o.row,t=l.enabled,l=l.contentMethod,r=r.tooltip,o=l?l(o):null,l=l&&!_xeUtils.default.eqNull(o),o=l?o:("html"===s.type?i.innerText:i.textContent).trim();return o&&(t||l||i.scrollWidth>i.clientWidth)&&(Object.assign(n,{row:a,column:s,visible:!0}),r&&r.toVisible(i,_tools.UtilTools.formatText(o))),this.$nextTick()},clostTooltip:function(){var e=this.$refs.tooltip;return Object.assign(this.tooltipStore,{row:null,column:null,content:null,visible:!1}),e&&e.close(),this.$nextTick()},isAllCheckboxChecked:function(){return this.isAllSelected},isCheckboxIndeterminate:function(){return this.isIndeterminate},getCheckboxIndeterminateRecords:function(){var e=this.treeConfig,t=this.treeIndeterminates;return e?t.slice(0):[]},handleDefaultSelectionChecked:function(){var t,i,o=this.fullDataRowIdData,r=this.checkboxOpts,l=this.checkboxReserveRowMap,e=r.checkAll,n=r.checkRowKeys;e?this.setAllCheckboxRow(!0):n&&(t=[],i=_tools.UtilTools.getRowkey(this),n.forEach(function(e){o[e]&&t.push(o[e].row),r.reserve&&(l[e]=_defineProperty({},i,e))}),this.setCheckboxRow(t,!0))},setCheckboxRow:function(e,t){var i=this;return e&&!_xeUtils.default.isArray(e)&&(e=[e]),e.forEach(function(e){return i.handleSelectRow({row:e},!!t)}),this.$nextTick()},isCheckedByCheckboxRow:function(e){var t=this.checkboxOpts.checkField;return t?_xeUtils.default.get(e,t):-1<this.selection.indexOf(e)},handleSelectRow:function(e,i){var o=this,r=e.row,l=this.selection,t=this.afterFullData,n=this.treeConfig,s=this.treeOpts,a=this.treeIndeterminates,c=this.checkboxOpts,h=c.checkField,e=c.checkStrictly,u=c.checkMethod;if(h)if(n&&!e){-1===i?(-1===a.indexOf(r)&&a.push(r),_xeUtils.default.set(r,h,!1)):_xeUtils.default.eachTree([r],function(t){r!==t&&u&&!u({row:t})||(_xeUtils.default.set(t,h,i),_xeUtils.default.remove(a,function(e){return e===t}),o.handleCheckboxReserveRow(r,i))},s);c=_xeUtils.default.findTree(t,function(e){return e===r},s);if(c&&c.parent){var d,f=u?c.items.filter(function(e){return u({row:e})}):c.items;return d=_xeUtils.default.find(c.items,function(e){return-1<a.indexOf(e)})?-1:(d=c.items.filter(function(e){return _xeUtils.default.get(e,h)})).filter(function(e){return-1<f.indexOf(e)}).length===f.length||!(!d.length&&-1!==i)&&-1,this.handleSelectRow({row:c.parent},d)}}else u&&!u({row:r})||(_xeUtils.default.set(r,h,i),this.handleCheckboxReserveRow(r,i));else if(n&&!e){-1===i?(-1===a.indexOf(r)&&a.push(r),_xeUtils.default.remove(l,function(e){return e===r})):_xeUtils.default.eachTree([r],function(t){r!==t&&u&&!u({row:t})||(i?l.push(t):_xeUtils.default.remove(l,function(e){return e===t}),_xeUtils.default.remove(a,function(e){return e===t}),o.handleCheckboxReserveRow(r,i))},s);s=_xeUtils.default.findTree(t,function(e){return e===r},s);if(s&&s.parent){var g,x=u?s.items.filter(function(e){return u({row:e})}):s.items;return g=_xeUtils.default.find(s.items,function(e){return-1<a.indexOf(e)})?-1:(g=s.items.filter(function(e){return-1<l.indexOf(e)})).filter(function(e){return-1<x.indexOf(e)}).length===x.length||!(!g.length&&-1!==i)&&-1,this.handleSelectRow({row:s.parent},g)}}else u&&!u({row:r})||(i?-1===l.indexOf(r)&&l.push(r):_xeUtils.default.remove(l,function(e){return e===r}),this.handleCheckboxReserveRow(r,i));this.checkSelectionStatus()},handleToggleCheckRowEvent:function(e,t){var i=this.selection,o=this.checkboxOpts.checkField,r=e.row,r=o?!_xeUtils.default.get(r,o):-1===i.indexOf(r);t?this.triggerCheckRowEvent(t,e,r):this.handleSelectRow(e,r)},triggerCheckRowEvent:function(e,t,i){var o=this.checkboxOpts.checkMethod;o&&!o({row:t.row})||(this.handleSelectRow(t,i),this.emitEvent("checkbox-change",Object.assign({records:this.getCheckboxRecords(),reserves:this.getCheckboxReserveRecords(),indeterminates:this.getCheckboxIndeterminateRecords(),checked:i},t),e))},toggleCheckboxRow:function(e){return this.handleToggleCheckRowEvent({row:e}),this.$nextTick()},setAllCheckboxRow:function(t){var i=this,o=this.afterFullData,e=this.treeConfig,r=this.treeOpts,l=this.selection,n=this.checkboxReserveRowMap,s=this.checkboxOpts,a=s.checkField,c=s.reserve,h=s.checkStrictly,u=s.checkMethod,d=[],f=e?[]:l.filter(function(e){return-1===o.indexOf(e)});h?this.isAllSelected=t:(a?(s=function(e){u&&!u({row:e})||_xeUtils.default.set(e,a,t)},h=function(e){(!u||!u({row:e})&&-1<l.indexOf(e))&&_xeUtils.default.set(e,a,t)},e?_xeUtils.default.eachTree(o,t?s:h,r):o.forEach(t?s:h)):e?t?_xeUtils.default.eachTree(o,function(e){u&&!u({row:e})||d.push(e)},r):u&&_xeUtils.default.eachTree(o,function(e){!u({row:e})&&-1<l.indexOf(e)&&d.push(e)},r):t?d=u?o.filter(function(e){return-1<l.indexOf(e)||u({row:e})}):o.slice(0):u&&(d=o.filter(function(e){return u({row:e})?0:-1<l.indexOf(e)})),c&&(t?d.forEach(function(e){n[_tools.UtilTools.getRowid(i,e)]=e}):o.forEach(function(e){e=_tools.UtilTools.getRowid(i,e);n[e]&&delete n[e]})),this.selection=f.concat(d)),this.treeIndeterminates=[],this.checkSelectionStatus()},checkSelectionStatus:function(){var e=this.afterFullData,t=this.selection,i=this.treeIndeterminates,o=this.checkboxOpts,r=this.treeConfig,l=o.checkField,n=o.halfField,s=o.checkStrictly,a=o.checkMethod;s||(s=o=!1,s=l?(o=e.length&&e.every(a?function(e){return!a({row:e})||_xeUtils.default.get(e,l)}:function(e){return _xeUtils.default.get(e,l)}),r?n?!o&&e.some(function(e){return _xeUtils.default.get(e,l)||_xeUtils.default.get(e,n)||-1<i.indexOf(e)}):!o&&e.some(function(e){return _xeUtils.default.get(e,l)||-1<i.indexOf(e)}):n?!o&&e.some(function(e){return _xeUtils.default.get(e,l)||_xeUtils.default.get(e,n)}):!o&&e.some(function(e){return _xeUtils.default.get(e,l)})):(o=e.length&&e.every(a?function(e){return!a({row:e})||-1<t.indexOf(e)}:function(e){return-1<t.indexOf(e)}),r?!o&&e.some(function(e){return-1<i.indexOf(e)||-1<t.indexOf(e)}):!o&&e.some(function(e){return-1<t.indexOf(e)})),this.isAllSelected=o,this.isIndeterminate=s)},handleReserveStatus:function(){var i,e=this.expandColumn,t=this.treeConfig,o=this.fullDataRowIdData,r=this.fullAllDataRowMap,l=this.currentRow,n=this.selectRow,s=this.radioReserveRow,a=this.radioOpts,c=this.checkboxReserveRowMap,h=this.checkboxOpts,u=this.selection,d=this.rowExpandeds,f=this.treeExpandeds,g=this.treeIndeterminates;n&&!r.has(n)&&(this.selectRow=null),a.reserve&&s&&(s=_tools.UtilTools.getRowid(this,s),o[s]&&this.setRadioRow(o[s].row)),this.selection=handleReserveRow(this,u),h.reserve&&(i=[],_xeUtils.default.each(c,function(e,t){o[t]&&-1===i.indexOf(o[t].row)&&i.push(o[t].row)}),this.setCheckboxRow(i,!0)),l&&!r.has(l)&&(this.currentRow=null),this.rowExpandeds=e?handleReserveRow(this,d):[],this.treeExpandeds=t?handleReserveRow(this,f):[],this.treeIndeterminates=t?handleReserveRow(this,g):[]},getRadioReserveRecord:function(){var e=this.fullDataRowIdData,t=this.radioReserveRow;return this.radioOpts.reserve&&t&&!e[_tools.UtilTools.getRowid(this,t)]?t:null},clearRadioReserve:function(){return this.radioReserveRow=null,this.$nextTick()},handleRadioReserveRow:function(e){this.radioOpts.reserve&&(this.radioReserveRow=e)},getCheckboxReserveRecords:function(){var i=this.fullDataRowIdData,e=this.checkboxReserveRowMap,t=this.checkboxOpts,o=[];return t.reserve&&_xeUtils.default.each(e,function(e,t){e&&!i[t]&&o.push(e)}),o},clearCheckboxReserve:function(){return this.checkboxReserveRowMap={},this.$nextTick()},handleCheckboxReserveRow:function(e,t){var i,o=this.checkboxReserveRowMap;this.checkboxOpts.reserve&&(i=_tools.UtilTools.getRowid(this,e),t?o[i]=e:o[i]&&delete o[i])},triggerCheckAllEvent:function(e,t){this.setAllCheckboxRow(t),this.emitEvent("checkbox-all",{records:this.getCheckboxRecords(),reserves:this.getCheckboxReserveRecords(),indeterminates:this.getCheckboxIndeterminateRecords(),checked:t},e)},toggleAllCheckboxRow:function(){return this.triggerCheckAllEvent(null,!this.isAllSelected),this.$nextTick()},clearCheckboxRow:function(){var t=this,e=this.tableFullData,i=this.treeConfig,o=this.treeOpts,r=this.checkboxOpts,l=this.checkboxReserveRowMap,n=r.checkField,r=r.reserve;return n&&(i?_xeUtils.default.eachTree(e,function(e){return _xeUtils.default.set(e,n,!1)},o):e.forEach(function(e){return _xeUtils.default.set(e,n,!1)})),r&&e.forEach(function(e){e=_tools.UtilTools.getRowid(t,e);l[e]&&delete l[e]}),this.isAllSelected=!1,this.isIndeterminate=!1,this.selection=[],this.treeIndeterminates=[],this.$nextTick()},handleDefaultRadioChecked:function(){var e=this.radioOpts,t=this.fullDataRowIdData,i=e.checkRowKey,e=e.reserve;i&&(t[i]&&this.setRadioRow(t[i].row),e&&(e=_tools.UtilTools.getRowkey(this),this.radioReserveRow=_defineProperty({},e,i)))},triggerRadioRowEvent:function(e,t){var i=this.selectRow!==t.row;this.setRadioRow(t.row),i&&this.emitEvent("radio-change",t,e)},triggerCurrentRowEvent:function(e,t){var i=this.currentRow!==t.row;this.setCurrentRow(t.row),i&&this.emitEvent("current-change",t,e)},setCurrentRow:function(e){return this.clearCurrentRow(),this.clearCurrentColumn(),this.currentRow=e,this.highlightCurrentRow&&_xeUtils.default.arrayEach(this.$el.querySelectorAll('[data-rowid="'.concat(_tools.UtilTools.getRowid(this,e),'"]')),function(e){return _tools.DomTools.addClass(e,"row--current")}),this.$nextTick()},isCheckedByRadioRow:function(e){return this.selectRow===e},setRadioRow:function(e){var t=this.radioOpts.checkMethod;return!e||t&&!t({row:e})||(this.selectRow=e,this.handleRadioReserveRow(e)),this.$nextTick()},clearCurrentRow:function(){return this.currentRow=null,this.hoverRow=null,_xeUtils.default.arrayEach(this.$el.querySelectorAll(".row--current"),function(e){return _tools.DomTools.removeClass(e,"row--current")}),this.$nextTick()},clearRadioRow:function(){return this.selectRow=null,this.$nextTick()},getCurrentRecord:function(){return this.highlightCurrentRow?this.currentRow:null},getRadioRecord:function(){return this.selectRow},triggerHoverEvent:function(e,t){t=t.row;this.setHoverRow(t)},setHoverRow:function(e){var t=_tools.UtilTools.getRowid(this,e);this.clearHoverRow(),_xeUtils.default.arrayEach(this.$el.querySelectorAll('[data-rowid="'.concat(t,'"]')),function(e){return _tools.DomTools.addClass(e,"row--hover")}),this.hoverRow=e},clearHoverRow:function(){_xeUtils.default.arrayEach(this.$el.querySelectorAll(".vxe-body--row.row--hover"),function(e){return _tools.DomTools.removeClass(e,"row--hover")}),this.hoverRow=null},triggerHeaderCellClickEvent:function(e,t){var i=this._lastResizeTime,o=this.sortOpts,r=t.column,l=e.currentTarget,n=i&&i>Date.now()-300,s=_tools.DomTools.getEventTargetNode(e,l,"vxe-cell--sort").flag,i=_tools.DomTools.getEventTargetNode(e,l,"vxe-cell--filter").flag;return"cell"!==o.trigger||n||s||i||this.triggerSortEvent(e,r,getNextSortOrder(this,r)),this.emitEvent("header-cell-click",Object.assign({triggerResizable:n,triggerSort:s,triggerFilter:i,cell:l},t),e),this.highlightCurrentColumn?this.setCurrentColumn(r):this.$nextTick()},triggerHeaderCellDBLClickEvent:function(e,t){this.emitEvent("header-cell-dblclick",Object.assign({cell:e.currentTarget},t),e)},getCurrentColumn:function(){return this.highlightCurrentColumn?this.currentColumn:null},setCurrentColumn:function(e){return this.clearCurrentRow(),this.clearCurrentColumn(),this.currentColumn=e,this.$nextTick()},clearCurrentColumn:function(){return this.currentColumn=null,this.$nextTick()},checkValidate:function(e){return _vXETable.default._valid?this.triggerValidate(e):this.$nextTick()},handleChangeCell:function(e,t){var i=this;this.checkValidate("blur").catch(function(e){return e}).then(function(){i.handleActived(t,e).then(function(){return i.checkValidate("change")}).catch(function(e){return e})})},triggerCellClickEvent:function(e,t){var i=this.highlightCurrentRow,o=this.editStore,r=this.radioOpts,l=this.expandOpts,n=this.treeOpts,s=this.editConfig,a=this.editOpts,c=this.checkboxOpts,h=o.actived,u=t.row,d=t.column,f=d.type,g=d.treeNode,x="radio"===f,p="checkbox"===f,v="expand"===f,m=e.currentTarget,w=x&&_tools.DomTools.getEventTargetNode(e,m,"vxe-cell--radio").flag,b=p&&_tools.DomTools.getEventTargetNode(e,m,"vxe-cell--checkbox").flag,o=g&&_tools.DomTools.getEventTargetNode(e,m,"vxe-tree--btn-wrapper").flag,f=v&&_tools.DomTools.getEventTargetNode(e,m,"vxe-table--expanded").flag;t=Object.assign({cell:m,triggerRadio:w,triggerCheckbox:b,triggerTreeNode:o,triggerExpandNode:f},t),!f&&("row"===l.trigger||v&&"cell"===l.trigger)&&this.triggerRowExpandEvent(e,t),("row"===n.trigger||g&&"cell"===n.trigger)&&this.triggerTreeExpandEvent(e,t),o||(f||(i&&(b||w||this.triggerCurrentRowEvent(e,t)),!w&&("row"===r.trigger||x&&"cell"===r.trigger)&&this.triggerRadioRowEvent(e,t),!b&&("row"===c.trigger||p&&"cell"===c.trigger)&&this.handleToggleCheckRowEvent(t,e)),s&&("manual"===a.trigger?h.args&&h.row===u&&d!==h.column&&this.handleChangeCell(e,t):h.args&&u===h.row&&d===h.column||("click"===a.trigger||"dblclick"===a.trigger&&"row"===a.mode&&h.row===u)&&this.handleChangeCell(e,t))),this.emitEvent("cell-click",t,e)},triggerCellDBLClickEvent:function(e,t){var i=this,o=this.editStore,r=this.editConfig,l=this.editOpts,n=o.actived,o=e.currentTarget;t.cell=o,r&&"dblclick"===l.trigger&&(n.args&&e.currentTarget===n.args.cell||("row"===l.mode?this.checkValidate("blur").catch(function(e){return e}).then(function(){i.handleActived(t,e).then(function(){return i.checkValidate("change")}).catch(function(e){return e})}):"cell"===l.mode&&this.handleActived(t,e).then(function(){return i.checkValidate("change")}).catch(function(e){return e}))),this.emitEvent("cell-dblclick",t,e)},handleDefaultSort:function(){var t,e,i=this.sortOpts.defaultSort;i&&(t=i.field,e=i.order,t&&e&&((i=_xeUtils.default.find(this.visibleColumn,function(e){return e.property===t}))&&!i.order&&this.sort(t,e)))},triggerSortEvent:function(e,t,i){var o,r=t.property;(t.sortable||t.remoteSort)&&(o={column:t,property:r,order:i,sortBy:t.sortBy},i&&t.order!==i?this.sort(r,i):(o.order=null,this.clearSort()),this.emitEvent("sort-change",o,e))},sort:function(e,t){var i=this.tableFullColumn,o=this.sortOpts,e=this.getColumnByField(e);if(e){o=_xeUtils.default.isBoolean(e.remoteSort)?e.remoteSort:o.remote;if(e.sortable||e.remoteSort)return arguments.length<=1&&(t=getNextSortOrder(this,e)),e.order!==t&&(i.forEach(function(e){e.order=null}),e.order=t,o||this.handleTableData(!0)),this.$nextTick().then(this.updateStyle)}return this.$nextTick()},clearSort:function(){return this.tableFullColumn.forEach(function(e){e.order=null}),this.handleTableData(!0)},getSortColumn:function(){return _xeUtils.default.find(this.visibleColumn,function(e){return e.sortable&&e.order})},closeFilter:function(){return Object.assign(this.filterStore,{isAllSelected:!1,isIndeterminate:!1,options:[],visible:!1}),this.$nextTick()},isFilter:function(e){if(e){e=this.getColumnByField(e);return e.filters&&e.filters.some(function(e){return e.checked})}return this.visibleColumn.some(function(e){return e.filters&&e.filters.some(function(e){return e.checked})})},isRowExpandLoaded:function(e){e=this.fullAllDataRowMap.get(e);return e&&e.expandLoaded},clearRowExpandLoaded:function(t){var e=this.expandOpts,i=this.expandLazyLoadeds,o=this.fullAllDataRowMap,e=e.lazy,o=o.get(t);return e&&o&&(o.expandLoaded=!1,_xeUtils.default.remove(i,function(e){return t===e})),this.$nextTick()},reloadExpandContent:function(e){var t=this,i=this.expandOpts,o=this.expandLazyLoadeds;return i.lazy&&-1===o.indexOf(e)&&this.clearRowExpandLoaded(e).then(function(){return t.handleAsyncRowExpand(e)}),this.$nextTick()},triggerRowExpandEvent:function(e,t){var i=this.expandOpts,o=this.expandLazyLoadeds,r=this.expandColumn,l=t.row;i.lazy&&-1!==o.indexOf(l)||(t=!this.isExpandByRow(l),i=this.getColumnIndex(r),o=this.$getColumnIndex(r),this.setRowExpand(l,t),this.emitEvent("toggle-row-expand",{expanded:t,column:r,columnIndex:i,$columnIndex:o,row:l,rowIndex:this.getRowIndex(l),$rowIndex:this.$getRowIndex(l)},e))},toggleRowExpand:function(e){return this.setRowExpand(e,!this.isExpandByRow(e))},handleDefaultRowExpand:function(){var t,e=this.expandOpts,i=this.fullDataRowIdData,o=e.expandAll,e=e.expandRowKeys;o?this.setAllRowExpand(!0):e&&(t=[],e.forEach(function(e){i[e]&&t.push(i[e].row)}),this.setRowExpand(t,!0))},setAllRowExpand:function(e){return this.setRowExpand(this.expandOpts.lazy?this.tableData:this.tableFullData,e)},handleAsyncRowExpand:function(t){var i=this,o=this.fullAllDataRowMap.get(t);return new Promise(function(e){i.expandLazyLoadeds.push(t),i.expandOpts.loadMethod({$table:i,row:t,rowIndex:i.getRowIndex(t),$rowIndex:i.$getRowIndex(t)}).catch(function(e){return e}).then(function(){o.expandLoaded=!0,_xeUtils.default.remove(i.expandLazyLoadeds,function(e){return e===t}),i.rowExpandeds.push(t),e(i.$nextTick().then(i.recalculate))})})},setRowExpand:function(e,t){var i,o=this,r=this.fullAllDataRowMap,l=this.expandLazyLoadeds,n=this.expandOpts,s=this.expandColumn,a=this.rowExpandeds,c=n.lazy,h=n.accordion,u=n.toggleMethod,d=[],f=this.getColumnIndex(s),g=this.$getColumnIndex(s);return e&&(_xeUtils.default.isArray(e)||(e=[e]),h&&(a=[],e=e.slice(e.length-1,e.length)),i=u?e.filter(function(e){return u({expanded:t,column:s,columnIndex:f,$columnIndex:g,row:e,rowIndex:o.getRowIndex(e),$rowIndex:o.$getRowIndex(e)})}):e,t?i.forEach(function(e){var t;-1===a.indexOf(e)&&(t=r.get(e),c&&!t.expandLoaded&&-1===l.indexOf(e)?d.push(o.handleAsyncRowExpand(e)):a.push(e))}):_xeUtils.default.remove(a,function(e){return-1<i.indexOf(e)})),this.rowExpandeds=a,Promise.all(d).then(this.recalculate)},isExpandByRow:function(e){return-1<this.rowExpandeds.indexOf(e)},clearRowExpand:function(){var e=this,t=this.rowExpandeds.length;return this.rowExpandeds=[],this.$nextTick().then(function(){return t?e.recalculate():0})},getRowExpandRecords:function(){return this.rowExpandeds.slice(0)},getTreeExpandRecords:function(){return this.treeExpandeds.slice(0)},getTreeStatus:function(){return this.treeConfig?{config:this.treeOpts,rowExpandeds:this.getTreeExpandRecords()}:null},isTreeExpandLoaded:function(e){e=this.fullAllDataRowMap.get(e);return e&&e.treeLoaded},clearTreeExpandLoaded:function(t){var e=this.treeOpts,i=this.treeExpandeds,o=this.fullAllDataRowMap,e=e.lazy,o=o.get(t);return e&&o&&(o.treeLoaded=!1,_xeUtils.default.remove(i,function(e){return t===e})),this.$nextTick()},reloadTreeChilds:function(e){var t=this,i=this.treeOpts,o=this.treeLazyLoadeds,r=i.lazy,i=i.hasChild;return r&&e[i]&&-1===o.indexOf(e)&&this.clearTreeExpandLoaded(e).then(function(){return t.handleAsyncTreeExpandChilds(e)}),this.$nextTick()},triggerTreeExpandEvent:function(e,t){var i=this.treeOpts,o=this.treeLazyLoadeds,r=this.expandColumn,l=t.row;i.lazy&&-1!==o.indexOf(l)||(t=!this.isTreeExpandByRow(l),i=this.getColumnIndex(r),o=this.$getColumnIndex(r),this.setTreeExpand(l,t),this.emitEvent("toggle-tree-expand",{expanded:t,column:r,columnIndex:i,$columnIndex:o,row:l},e))},toggleTreeExpand:function(e){return this.setTreeExpand(e,!this.isTreeExpandByRow(e))},handleDefaultTreeExpand:function(){var e,i,o,t=this.treeConfig,r=this.treeOpts,l=this.tableFullData;t&&(e=r.expandAll,t=r.expandRowKeys,e?this.setAllTreeExpand(!0):t&&(i=[],o=_tools.UtilTools.getRowkey(this),t.forEach(function(t){var e=_xeUtils.default.findTree(l,function(e){return t===_xeUtils.default.get(e,o)},r);e&&i.push(e.item)}),this.setTreeExpand(i,!0)))},handleAsyncTreeExpandChilds:function(i){var o=this,e=this.fullAllDataRowMap,r=this.treeExpandeds,t=this.treeOpts,l=this.treeLazyLoadeds,n=this.checkboxOpts,s=t.loadMethod,a=t.children,c=n.checkStrictly,h=e.get(i);return new Promise(function(t){l.push(i),s({$table:o,row:i}).catch(function(){return[]}).then(function(e){h.treeLoaded=!0,_xeUtils.default.remove(l,function(e){return e===i}),_xeUtils.default.isArray(e)||(e=[]),e&&(i[a]=e,o.appendTreeCache(i,e),e.length&&-1===r.indexOf(i)&&r.push(i),!c&&o.isCheckedByCheckboxRow(i)&&o.setCheckboxRow(e,!0)),t(o.$nextTick().then(o.recalculate))})})},setAllTreeExpand:function(e){var t=this.tableFullData,i=this.treeOpts,o=i.lazy,r=i.children,l=[];return _xeUtils.default.eachTree(t,function(e){var t=e[r];(o||t&&t.length)&&l.push(e)},i),this.setTreeExpand(l,e)},setTreeExpand:function(t,i){var o,r=this,l=this.fullAllDataRowMap,e=this.tableFullData,n=this.treeExpandeds,s=this.treeOpts,a=this.treeLazyLoadeds,c=this.expandColumn,h=s.lazy,u=s.hasChild,d=s.children,f=s.accordion,g=s.toggleMethod,x=[],p=this.getColumnIndex(c),v=this.$getColumnIndex(c);if(t&&(_xeUtils.default.isArray(t)||(t=[t]),t.length)){f&&(t=t.slice(t.length-1,t.length),o=_xeUtils.default.findTree(e,function(e){return e===t[0]},s),_xeUtils.default.remove(n,function(e){return-1<o.items.indexOf(e)}));var m=g?t.filter(function(e){return g({expanded:i,column:c,columnIndex:p,$columnIndex:v,row:e})}):t;return i?m.forEach(function(e){var t;-1===n.indexOf(e)&&(t=l.get(e),h&&e[u]&&!t.treeLoaded&&-1===a.indexOf(e)?x.push(r.handleAsyncTreeExpandChilds(e)):e[d]&&e[d].length&&n.push(e))}):_xeUtils.default.remove(n,function(e){return-1<m.indexOf(e)}),Promise.all(x).then(this.recalculate)}return Promise.resolve()},isTreeExpandByRow:function(e){return-1<this.treeExpandeds.indexOf(e)},clearTreeExpand:function(){var e=this,t=this.treeExpandeds.length;return this.treeExpandeds=[],this.$nextTick().then(function(){return t?e.recalculate():0})},getScroll:function(){var e=this.$refs,t=this.scrollXLoad,i=this.scrollYLoad,e=e.tableBody.$el;return{virtualX:t,virtualY:i,scrollTop:e.scrollTop,scrollLeft:e.scrollLeft}},triggerScrollXEvent:function(){this.loadScrollXData()},loadScrollXData:function(e){for(var t=this.$refs,i=this.visibleColumn,o=this.scrollXStore,r=o.startIndex,l=o.renderSize,n=o.offsetSize,s=o.visibleSize,a=t.tableBody.$el.scrollLeft,c=0,h=0,t=e||!1,u=i.length,d=0;d<u;d++)if(a<(h+=i[d].renderWidth)){c=d;break}!e&&o.visibleIndex===c||(e=Math.min(Math.floor((l-s)/2),s),o.visibleIndex===c?o.startIndex=c:o.visibleIndex>c?(t=c-n<=r)&&(o.startIndex=Math.max(0,Math.max(0,c-e))):(t=r+l<=c+s+n)&&(o.startIndex=Math.max(0,Math.min(i.length-l,c-e))),t&&this.updateScrollXData(),o.visibleIndex=c),this.clostTooltip()},triggerScrollYEvent:function(e){isWebkit&&this.scrollYStore.adaptive?this.loadScrollYData(e):this.debounceScrollY(e)},debounceScrollY:_xeUtils.default.debounce(function(e){this.loadScrollYData(e)},debounceScrollYDuration,{leading:!1,trailing:!0}),loadScrollYData:function(e){var t=this.afterFullData,i=this.scrollYStore,o=this.isLoadData,r=i.startIndex,l=i.renderSize,n=i.offsetSize,s=i.visibleSize,a=i.rowHeight,e=e.target.scrollTop,e=Math.ceil(e/a),a=!1;!o&&i.visibleIndex===e||(o=Math.min(Math.floor((l-s)/2),s),i.visibleIndex>e?(a=e-n<=r)&&(i.startIndex=Math.max(0,e-Math.max(o,l-s))):(a=r+l<=e+s+n)&&(i.startIndex=Math.max(0,Math.min(t.length-l,e-o))),a&&this.updateScrollYData(),i.visibleIndex=e,this.isLoadData=!1)},computeRowHeight:function(){var e,t=this.$refs.tableBody,i=t?t.$el:null,t=this.$refs.tableHeader;i&&(!(i=i.querySelector("tbody>tr"))&&t&&(i=t.$el.querySelector("thead>tr")),i&&(e=i.clientHeight)),e=e||this.rowHeightMaps[this.vSize||"default"],this.rowHeight=e},computeScrollLoad:function(){var v=this;return this.$nextTick().then(function(){var e,t=v.vSize,i=v.scrollXLoad,o=v.scrollYLoad,r=v.sXOpts,l=v.scrollYStore,n=v.sYOpts,s=v.scrollXStore,a=v.visibleColumn,c=v.rowHeightMaps,h=v.$refs.tableBody,u=h?h.$el:null,h=v.$refs.tableHeader;if(u){if(i){var d=u.clientWidth,f=_xeUtils.default.toNumber(r.vSize);if(!r.vSize)for(var g=f=a.length,x=0,p=0;p<g;p++)if(d<(x+=a[p].renderWidth)){f=p+1;break}s.visibleSize=f,r.oSize||(s.offsetSize=f),r.rSize||(s.renderSize=Math.max(8,f+6)),v.updateScrollXData()}else v.updateScrollXSpace();o?(n.rHeight?e=n.rHeight:(!(o=u.querySelector("tbody>tr"))&&h&&(o=h.$el.querySelector("thead>tr")),o&&(e=o.clientHeight)),e=e||c[t||"default"],u=_xeUtils.default.toNumber(n.vSize||Math.ceil(u.clientHeight/e)),l.visibleSize=u,l.rowHeight=e,n.oSize||(l.offsetSize=u),n.rSize||(l.renderSize=Math.max(6,browse.edge?10*u:isWebkit?u+2:6*u)),v.updateScrollYData()):v.updateScrollYSpace()}v.$nextTick(v.updateStyle)})},updateScrollXData:function(){var e=this.visibleColumn,t=this.scrollXStore;this.tableColumn=e.slice(t.startIndex,t.startIndex+t.renderSize),this.updateScrollXSpace()},updateScrollXSpace:function(){var e=this.$refs,o=this.elemStore,t=this.visibleColumn,i=this.scrollXStore,r=this.scrollXLoad,l=this.tableWidth,n=this.scrollbarWidth,s=e.tableHeader,a=e.tableBody,e=e.tableFooter,s=s?s.$el.querySelector(".vxe-table--header"):null,a=a.$el.querySelector(".vxe-table--body"),e=e?e.$el.querySelector(".vxe-table--footer"):null,t=t.slice(0,i.startIndex).reduce(function(e,t){return e+t.renderWidth},0),i="";r&&(i="".concat(t,"px")),s&&(s.style.marginLeft=i),a.style.marginLeft=i,e&&(e.style.marginLeft=i);["main"].forEach(function(i){["header","body","footer"].forEach(function(e){var t=o["".concat(i,"-").concat(e,"-xSpace")];t&&(t.style.width=r?"".concat(l+("header"===e?n:0),"px"):"")})}),this.$nextTick(this.updateStyle)},updateScrollYData:function(){this.handleTableData(),this.updateScrollYSpace()},updateScrollYSpace:function(){var i=this.elemStore,e=this.scrollYStore,t=this.scrollYLoad,o=this.afterFullData.length*e.rowHeight,e=Math.max(e.startIndex*e.rowHeight,0),r="",l="";t&&(r="".concat(e,"px"),l="".concat(o,"px")),["main","left","right"].forEach(function(t){var e=i["".concat(t,"-body-table")];e&&(e.style.marginTop=r),["header","body","footer"].forEach(function(e){e=i["".concat(t,"-").concat(e,"-ySpace")];e&&(e.style.height=l)})}),this.$nextTick(this.updateStyle)},scrollTo:function(e,t){var i,o,r=this,l=this.$refs,n=l.tableBody.$el;return _xeUtils.default.isNumber(e)&&((o=l.tableFooter?l.tableFooter.$el:null)?(o.scrollLeft=e,_tools.DomTools.triggerEvent(o,"scroll")):(i=!0,n.scrollLeft=e)),_xeUtils.default.isNumber(t)&&((l=l.rightBody?l.rightBody.$el:null)?(l.scrollTop=t,_tools.DomTools.triggerEvent(l,"scroll")):(i=!0,n.scrollTop=t)),i&&_tools.DomTools.triggerEvent(n,"scroll"),this.scrollXLoad||this.scrollYLoad?new Promise(function(e){return setTimeout(function(){return e(r.$nextTick())},50)}):this.$nextTick()},scrollToRow:function(e,t){var i=[];return e&&(this.treeConfig?i.push(this.scrollToTreeRow(e)):i.push(_tools.DomTools.rowToVisible(this,e))),i.push(this.scrollToColumn(t)),Promise.all(i)},scrollToColumn:function(e){return e&&this.fullColumnMap.has(e)?_tools.DomTools.colToVisible(this,e):this.$nextTick()},scrollToTreeRow:function(t){var i,o=this,e=this.tableFullData,r=this.treeConfig,l=this.treeOpts;return!r||(l=_xeUtils.default.findTree(e,function(e){return e===t},l))&&(i=l.nodes).forEach(function(e,t){t<i.length-1&&!o.isTreeExpandByRow(e)&&o.setTreeExpand(e,!0)}),this.$nextTick()},clearScroll:function(){var t=this,e=this.$refs,i=e.tableBody,i=i?i.$el:null,e=e.tableFooter,e=(e?e.$el:null)||i;return i&&(i.scrollTop=0),e&&(e.scrollLeft=0),new Promise(function(e){return setTimeout(function(){return e(t.$nextTick())})})},updateFooter:function(){var e=this.showFooter,t=this.visibleColumn,i=this.footerMethod;return e&&i&&(this.footerData=t.length?i({columns:t,data:this.afterFullData}):[]),this.$nextTick()},updateStatus:function(s,a){var c=this,h=!_xeUtils.default.isUndefined(a);return this.$nextTick().then(function(){var e=c.$refs,t=c.tableData,i=c.editRules,o=c.validStore;if(s&&e.tableBody&&i){var r=s.row,l=s.column;if(c.hasCellRules("change",r,l)){var t=t.indexOf(r),n=_tools.DomTools.getCell(c,{row:r,rowIndex:t,column:l});if(n)return c.validCellRules("change",r,l,a).then(function(){h&&o.visible&&_tools.UtilTools.setCellValue(r,l,a),c.clearValidate()}).catch(function(e){e=e.rule;h&&_tools.UtilTools.setCellValue(r,l,a),c.showValidTooltip({rule:e,row:r,column:l,cell:n})})}}})},updateZindex:function(){this.zIndex?this.tZindex=this.zIndex:this.tZindex<_tools.UtilTools.getLastZIndex()&&(this.tZindex=_tools.UtilTools.nextZIndex())},emitEvent:function(e,t,i){this.$emit(e,Object.assign({$table:this,$grid:this.$xegrid,$event:i},t))},focus:function(){return this.isActivated=!0,this.$nextTick()},blur:function(){return this.isActivated=!1,this.$nextTick()},connect:function(e){e&&e.syncUpdate?(e.syncUpdate({collectColumn:this.collectColumn,$table:this}),this.$toolbar=e):_tools.UtilTools.error("vxe.error.barUnableLink")},calcTableWidth:function(){var a=this;this.$nextTick(function(){var r,e,t,i,o,l,n,s=a.getTableColumn().fullColumn;s.every(function(e){return!1===e.resizable})||(r=a.$props.id||window.location.href,e="".concat(r,"ScrollWrapper"),new ResizeObserver(function(e){e.forEach(function(e){a.$nextTick(function(){var e,t=localStorage.getItem("columnWidth"),i=t?JSON.parse(t):{},o="".concat(r,"ScrollWrapper");a.$refs[o]&&a.$refs[o].clientWidth&&(e=parseInt(a.$refs[o].clientWidth,10),t=_xeUtils.default.sum(a.dropRight(s.map(function(e){return e.width}))),o=s.length,i[r][o-1]=40<e-t?e-t:40,s[o-1].width=40<e-t?e-t:40,localStorage.setItem("columnWidth",JSON.stringify(i)),a.loadColumn(s))})})}).observe(a.$refs[e]),t=localStorage.getItem("columnWidth"),i=t?JSON.parse(t):{},o=parseInt(a.$refs[e].clientWidth,10),i&&i[r]||(s.forEach(function(e){e.width||("checkbox"===e.type?e.width=56:e.title?e.width=12*e.title.length+32+25:e.width=0)}),i[r]=s.map(function(e){return e.width})),l=_xeUtils.default.sum(a.dropRight(i[r])),n=s.length,s.forEach(function(e,t){t===n-1?(e.width=40<o-l?o-l:40,i[r][n-1]=e.width):e.width=i[r][t]}),a.recordWidth=_xeUtils.default.sum(i[r]),localStorage.setItem("columnWidth",JSON.stringify(i)),setTimeout(function(){a.refreshColumn(),a.loadColumn(s)},0))})},dropRight:function(e){var t=e.length;return e.slice(0,t-1)},hideDropdown:function(){var e=this,t=this.$props.id||window.location.href,i="".concat(t,"ScrollWrapper"),o=this.$refs[i].querySelector(".vxe-table--body-wrapper");o&&o.addEventListener("scroll",this.hideDropdownOperation);var r=new ResizeObserver(this.hideDropdownOperation),i="".concat(t,"-table"),t=this.$refs[i].querySelector(".vxe-table--header");t&&r.observe(t);var l=new ResizeObserver(this.calcTableHeight),i=this.$refs[i];i&&l.observe(i),this.$once("hook:beforeDestroy",function(){o&&o.removeEventListener("scroll",e.hideDropdownOperation),r.disconnect(),l.disconnect()})},calcTableHeight:function(){var e=this.$props.id||window.location.href,e="".concat(e,"-table"),e=this.$refs[e].parentNode.querySelector(".vxe-pager--wrapper");!e||(e=parseFloat(getComputedStyle(e).height))&&(this.tableHeightByPager="calc(100% - ".concat(e+100,"px)"))},hideDropdownOperation:function(){var e,t=document.activeElement;t&&t.classList.contains("ant-dropdown-trigger")&&t.classList.contains("ant-dropdown-open")&&(e=new MouseEvent("click"),t.dispatchEvent(e))}},funcs="setFilter,clearFilter,closeMenu,getSelectedCell,clearSelected,insert,insertAt,remove,removeCheckboxRow,removeRadioRow,removeCurrentRow,getRecordset,getInsertRecords,getRemoveRecords,getUpdateRecords,clearActived,getActiveRecord,isActiveByRow,setActiveRow,setActiveCell,setSelectCell,clearValidate,fullValidate,validate,openExport,exportData,openImport,importData,readFile,importByFile,print,openCustom".split(",");funcs.forEach(function(e){Methods[e]=function(){return this["_".concat(e)]?this["_".concat(e)].apply(this,arguments):null}});var _default=Methods;exports.default=Methods;