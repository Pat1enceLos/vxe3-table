"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils/methods/xe-utils")),_tools=require("../../tools"),_util=require("./util");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,l){return t in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e}var cellType="header",_default={name:"VxeTableHeader",props:{tableData:Array,tableColumn:Array,visibleColumn:Array,tableGroupColumn:Array,fixedColumn:Array,size:String,fixedType:String,isGroup:Boolean},data:function(){return{headerColumn:[]}},watch:{tableColumn:function(){this.uploadColumn()}},created:function(){this.uploadColumn()},mounted:function(){var e=this.$parent,t=this.$el,l=this.$refs,o=this.fixedType,e=e.elemStore,o="".concat(o||"main","-header-");e["".concat(o,"wrapper")]=t,e["".concat(o,"table")]=l.table,e["".concat(o,"colgroup")]=l.colgroup,e["".concat(o,"list")]=l.thead,e["".concat(o,"xSpace")]=l.xSpace,e["".concat(o,"repair")]=l.repair},render:function(y){var _=this,e=this._e,v=this.$parent,C=this.fixedType,t=this.headerColumn,l=this.fixedColumn,w=v.$listeners,o=v.tId,T=v.resizable,$=v.border,z=v.columnKey,r=v.headerRowClassName,S=v.headerCellClassName,i=v.headerRowStyle,W=v.headerCellStyle,P=v.showHeaderOverflow,I=v.headerAlign,D=v.align,k=v.highlightCurrentColumn,R=v.currentColumn,U=v.scrollXLoad,M=v.overflowX,n=v.scrollbarWidth,O=v.tooltipOpts,H=v.sortOpts,a=this.tableColumn;return U&&C&&(a=l),y("div",{class:["vxe-table--header-wrapper",C?"fixed-".concat(C,"--wrapper"):"body--wrapper"],attrs:{"data-tid":o}},[C?e():y("div",{class:"vxe-body--x-space",ref:"xSpace"}),y("table",{class:"vxe-table--header",attrs:{"data-tid":o,cellspacing:0,cellpadding:0,border:0},ref:"table"},[y("colgroup",{ref:"colgroup"},a.map(function(e,t){return y("col",{attrs:{name:e.id},key:t})}).concat(n?[y("col",{attrs:{name:"col_gutter"}})]:[])),y("thead",{ref:"thead"},t.map(function(b,g){return y("tr",{class:["vxe-header--row",r?_xeUtils.default.isFunction(r)?r({$table:v,$rowIndex:g,fixed:C,type:cellType}):r:""],style:i?_xeUtils.default.isFunction(i)?i({$table:v,$rowIndex:g,fixed:C,type:cellType}):i:null},b.map(function(t,e){var l=t.type,o=t.showHeaderOverflow,r=t.headerAlign,i=t.align,n=t.headerClassName,a=O.enabled,s=t.children&&t.children.length,d=C?t.fixed!==C&&!s:t.fixed&&M,c=_xeUtils.default.isUndefined(o)||_xeUtils.default.isNull(o)?P:o,u=r||i||I||D,p="ellipsis"===c,f="title"===c,h=!0===c||"tooltip"===c,m=f||h||p,o={},r=t.filters&&t.filters.some(function(e){return e.checked}),i=v.getColumnIndex(t),c=v._getColumnIndex(t),x={$table:v,$rowIndex:g,column:t,columnIndex:i,$columnIndex:e,_columnIndex:c,fixed:C,type:cellType,isHidden:d,hasFilter:r};return U&&!m&&(p=m=!0),(f||h||a)&&(o.mouseenter=function(e){v._isResize||(f?_tools.DomTools.updateCellTitle(e,t):(h||a)&&v.triggerHeaderTooltipEvent(e,x))}),(h||a)&&(o.mouseleave=function(e){v._isResize||(h||a)&&v.handleTargetLeaveEvent(e)}),(k||w["header-cell-click"]||"cell"===H.trigger)&&(o.click=function(e){return v.triggerHeaderCellClickEvent(e,x)}),w["header-cell-dblclick"]&&(o.dblclick=function(e){return v.triggerHeaderCellDBLClickEvent(e,x)}),y("th",{class:["vxe-header--column",t.id,(_defineProperty(c={},"col--".concat(u),u),_defineProperty(c,"col--".concat(l),l),_defineProperty(c,"col--last",e===b.length-1),_defineProperty(c,"col--fixed",t.fixed),_defineProperty(c,"col--group",s),_defineProperty(c,"col--ellipsis",m),_defineProperty(c,"fixed--hidden",d),_defineProperty(c,"is--sortable",t.sortable),_defineProperty(c,"is--filter",!!t.filters),_defineProperty(c,"filter--active",r),_defineProperty(c,"col--current",R===t),c),_tools.UtilTools.getClass(n,x),_tools.UtilTools.getClass(S,x)],attrs:{"data-colid":t.id,colspan:1<t.colSpan?t.colSpan:null,rowspan:1<t.rowSpan?t.rowSpan:null},style:W?_xeUtils.default.isFunction(W)?W(x):W:null,on:o,key:z||s?t.id:e},[y("div",{class:["vxe-cell",{"c--title":f,"c--tooltip":h,"c--ellipsis":p}]},t.renderHeader(y,x)),!d&&!s&&(_xeUtils.default.isBoolean(t.resizable)?t.resizable:T)?y("div",{class:["vxe-resizable",{"is--line":!$||"none"===$}],on:{mousedown:function(e){return _.resizeMousedown(e,x)}}}):null])}).concat(n?[y("th",{class:"col--gutter",style:{background:"white","border-width":"0 0 1px 0px","border-style":"solid","border-color":"rgba(0, 0, 0, 0.06)"}})]:[]))}))]),y("div",{class:"vxe-table--header-border-line",ref:"repair"})])},methods:{uploadColumn:function(){this.headerColumn=this.isGroup?(0,_util.convertToRows)(this.tableGroupColumn):[this.$parent.scrollXLoad&&this.fixedType?this.fixedColumn:this.tableColumn]},resizeMousedown:function(e,a){var s=this,d=a.column,c=this.$parent,t=this.$el,l=this.fixedType,o=c.$refs,r=o.tableBody,i=o.leftContainer,n=o.rightContainer,u=o.resizeBar,o=e.target,p=e.clientX,f=o.parentNode,h=0,m=r.$el,r=_tools.DomTools.getOffsetPos(o,t),t=o.clientWidth,o=Math.floor(t/2),x=d.getMinWidth()-o,b=r.left-f.clientWidth+t+x,g=r.left+o,y=document.onmousemove,_=document.onmouseup,v="left"===l,C="right"===l,w=0;if(v||C){for(var T=v?"nextElementSibling":"previousElementSibling",$=f[T];$&&!_tools.DomTools.hasClass($,"fixed--hidden");)_tools.DomTools.hasClass($,"col--group")||(w+=$.offsetWidth),$=$[T];C&&n&&(g=n.offsetLeft+w)}o=function(e){e.stopPropagation(),e.preventDefault();var t=e.clientX-p,e=g+t,t=l?0:m.scrollLeft;v?e=Math.min(e,(n?n.offsetLeft:m.clientWidth)-w-x):C&&(b=(i?i.clientWidth:0)+w+x,e=Math.min(e,g+f.clientWidth-x)),h=Math.max(e,b),u.style.left="".concat(h-t,"px")};c._isResize=!0,_tools.DomTools.addClass(c.$el,"c--resize"),u.style.display="block",document.onmousemove=o,document.onmouseup=function(e){var t,l,o,r,i,n;document.onmousemove=y,document.onmouseup=_,d.resizeWidth=d.renderWidth+(C?g-h:h-g),!1!==s.$props.resizable&&(t=s.$parent.$props.id||window.location.href,(l=(i=localStorage.getItem("columnWidth"))?JSON.parse(i):{})&&l[t]&&(d.width=d.resizeWidth,o=c.getTableColumn().fullColumn,n="".concat(t,"ScrollWrapper"),r=parseInt(s.$parent.$refs[n].clientWidth,10),l[t][a.columnIndex]=parseInt(d.resizeWidth,10),i=l[t].length,n=_xeUtils.default.sum(l[t].slice(0,i-1)),o[o.length-1].width=40<r-n?r-n:40,l[t][i-1]=40<r-n?r-n:40,localStorage.setItem("columnWidth",JSON.stringify(l)))),u.style.display="none",c._isResize=!1,c._lastResizeTime=Date.now(),c.analyColumnWidth(),c.recalculate(!0),_tools.DomTools.removeClass(c.$el,"c--resize"),c.saveCustomResizable(),c.emitEvent("resizable-change",a,e)},o(e)}}};exports.default=_default;